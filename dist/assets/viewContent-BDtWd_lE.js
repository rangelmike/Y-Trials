import"./modulepreload-polyfill-B5Qt9EMX.js";import{getDatabase as M,ref as X,get as Z,child as W}from"https://www.gstatic.com/firebasejs/9.15.0/firebase-database.js";import{initializeApp as ee}from"https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";import{getAuth as te,signOut as oe}from"https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";import{u as ne,r as se}from"./manageDbAndSs-BgUixtgR.js";var d={FIREBASE_API_KEY:'"AIzaSyBnbcPg2bm9uNHtQvSCKwneB9qyUC4RYPs"',FIREBASE_AUTH_DOMAIN:'"y-trials.firebaseapp.com"',FIREBASE_DATABASE_URL:'"https://y-trials-default-rtdb.firebaseio.com"',FIREBASE_PROJECT_ID:'"y-trials"',FIREBASE_STORAGE_BUCKET:'"y-trials.appspot.com"',FIREBASE_MESSAGING_SENDER_ID:'"38252670103"',FIREBASE_APP_ID:'"1:38252670103:web:e93dd07b17de6537bc4dd2"',FIREBASE_MEASUREMENT_ID:'"G-DHZ2M1NK82"',SPREADSHEET_APP_ID:'"https://script.google.com/macros/s/AKfycbxCcBN7Ono829TeRK8iB3QQmZCsBSrds_h4a0pXClcl8T6SEo-TM4oEAShs5fCRXP1V/exec"'};const ae={apiKey:d.FIREBASE_API_KEY.replace(/"/g,""),authDomain:d.FIREBASE_AUTH_DOMAIN.replace(/"/g,""),projectId:d.FIREBASE_PROJECT_ID.replace(/"/g,""),storageBucket:d.FIREBASE_STORAGE_BUCKET.replace(/"/g,""),messagingSenderId:d.FIREBASE_MESSAGING_SENDER_ID.replace(/"/g,""),appId:d.FIREBASE_APP_ID.replace(/"/g,""),measurementId:d.FIREBASE_MEASUREMENT_ID.replace(/"/g,""),databaseURL:d.FIREBASE_DATABASE_URL.replace(/"/g,"")},U=ee(ae);M(U);const ie=te(U),ce=document.getElementById("datos"),re=document.getElementById("loader"),v=document.getElementById("UpLoader"),D=sessionStorage.getItem("myName"),B=document.getElementById("UpStuff");let i;class de{constructor(){this.items=[]}enqueue(e){this.items.push(e)}dequeue(){if(this.isEmpty())throw new Error("Queue is empty");return this.items.shift()}peek(){if(this.isEmpty())throw new Error("Queue is empty");return this.items[0]}isEmpty(){return this.items.length===0}size(){return this.items.length}print(){console.log(this.items.toString())}}let f=new de;document.getElementById("theme-toggle").addEventListener("click",function(){const o=document.body,e=document.getElementById("theme-icon");o.classList.toggle("dark-mode"),o.classList.toggle("light-mode"),o.classList.contains("dark-mode")?(e.textContent="🌙",localStorage.setItem("theme","dark")):(e.textContent="☀️",localStorage.setItem("theme","light"))});window.addEventListener("DOMContentLoaded",o=>{const e=localStorage.getItem("theme"),n=document.body,c=document.getElementById("theme-icon");e?(n.classList.add(e+"-mode"),c.textContent=e==="dark"?"🌙":"☀️"):(n.classList.add("light-mode"),c.textContent="☀️")});document.getElementById("logoutBtn").addEventListener("click",()=>{oe(ie),window.location.href="index.html"});B.addEventListener("click",async()=>{document.getElementById("UpSheet").checked&&(B.style.display="none",v.style.display="flex",await ne(i,D)),document.getElementById("reset").checked&&(await se(i),location.reload()),B.style.display="block",v.style.display="none"});function a(o){const e=document.createElement("p");return e.textContent=o,e}function m(o,e){let n=0;if(i[e][o]!=null)for(const c of Object.values(i[e][o]))n+=c;return n}function S(o,e){let n="",c=0;if(i[e][o]!=null)for(const s of Object.values(i[e][o]))n+=s+"; ",c++;return{str:n,num:c}}function le(o){return o=="none"?"block":"none"}function me(o){return o.filter(n=>n.trim()!=="").map(n=>`- ${n}`).join(`
`)}function O(o){const e=document.createElement("div"),n=document.createElement("div");return e.classList="bar-container",n.classList="bar",n.style.width=`${o}%`,e.append(n),e}function pe(o,e){const n=document.createElement("div"),c=document.createElement("h3");c.textContent=o+" ("+i[o].NombreCentro+")",n.append(c),ce.append(n);for(const s of e){if(i[s]==null){const r=document.createElement("p");r.textContent=`No hay registros de infromación aún sobre ${s}`,n.append(r);continue}const g=document.createElement("h4"),t=document.createElement("div");g.textContent=s,t.classList=s,t.classList.add("hijoDiv"),n.append(g),n.append(t);const l=document.createElement("div");l.style.display="none",l.classList="asistDiv";const{str:q,num:K}=S("wentDates",s),_=q.split("; ").filter(Boolean),y=K;l.append(a("Fechas que asistio: "+_));const{str:G,num:H}=S("missedDates",s),R=G.split("; ").filter(Boolean),Q=H;l.append(a("Fechas que falto: "+R));const T=a("Asistencias: (click mostrar u ocultar detalles)");T.addEventListener("click",function(){l.style.display=le(l.style.display)}),t.append(T),t.append(l);const h=document.createElement("div");h.id=`calendar-${s}`,t.append(h),new FullCalendar.Calendar(h,{initialView:"dayGridMonth",events:[..._.map(r=>({title:"Asistió",start:r,backgroundColor:"green",borderColor:"green",allDay:!0})),...R.map(r=>({title:"Faltó",start:r,backgroundColor:"red",borderColor:"red",allDay:!0}))]}).render();const p=Number(y+Q),L=`${Math.floor(100*y/p)}`;t.append(a("Porcentaje de asistencia: "+L+`% (${y}/${p})`)),t.append(O(L));const w=m("rprts",s);t.append(a(`Total de reportes: ${w}`)),t.append(a(`Promedio reportes: ${(w/p).toFixed(2)}`));const x=m("ejercicio",s);t.append(a(`Total dias de ejercicio: ${x}`)),t.append(a(`Promedio dias de ejercicio: ${(x/p).toFixed(2)}`));const z=m("cuotas",s);t.append(a(`Total cuotas pagadas: ${z}`));const E=m("DoneComis",s),Y=m("NotComis",s),I=E+Y;t.append(a(`Promedio de cumplimiento de comisiones: ${(E*100/I).toFixed(2)}% (${E}/${I})`)),t.append(O(E*100/I));const A=i[s].ListComis;if(A!=null&&A!=""){t.append(a("Comisiones pendientes: "));const r=document.createElement("textarea");r.value=me(A),r.style.height="auto",r.setAttribute("readonly","true"),t.append(r)}else t.append(a("Comisiones pendientes: ninguna"));let F="",k="";i[s].actBook!=null&&(F=Object.keys(i[s].actBook),k=Object.values(i[s].actBook)),t.append(a(`Actualmente leyendo: ${F} /Desde: ${k}`));const{str:J,num:Ee}=S("listBooks",s),V=J;t.append(a(`Lista de libros leidos: ${V}`)),g.addEventListener("click",function(){t.classList.contains("showing")?(t.classList.remove("showing"),t.classList.add("hiding")):(t.classList.contains("hiding")&&t.classList.remove("hiding"),t.classList.add("showing"))});const N=m("misas",s);t.append(a(`Total de misas acudidas: ${N}`)),t.append(a(`Promedio dias de misas por semana: ${(N/p).toFixed(2)}`));const $=m("rosarios",s);t.append(a(`Total de rosarios: ${$}`)),t.append(a(`Promedio de rosarios por semana: ${($/p).toFixed(2)}`));const P=i[s].observaciones;if(P!=null){const r=a("Observaciones:");r.style.marginBottom="0px",t.append(r);const u=document.createElement("textarea");u.value=P,u.style.height="auto",u.setAttribute("readonly","true"),u.onmousedown=function(b){b.preventDefault()},u.onselectstart=function(b){b.preventDefault()},t.append(u)}else t.append(a("Observaciones: ninguna"))}}function C(){if(!f.isEmpty()){const o=f.dequeue();if(i[o]==null){C();return}let e=i[o].subs;if(e!=null){e=Object.values(e);for(const n of e)f.enqueue(n);pe(o,e)}C()}}function j(o){const e=X(M());return Z(W(e,o)).then(n=>n.exists()?n.val():(console.log("No data available"),0)).catch(n=>(console.error(n),0))}window.onload=async function(){const o=sessionStorage.getItem("myEmail");o==""&&(window.location.href="index.html");const e=Object.keys(await j("jefe"))[0].replace(/,/g,".");if(v.style.display="none",e==o){const n=document.querySelectorAll(".NO");for(let c=0;c<n.length;c++)n[c].style.display="block"}document.getElementById("email").textContent=o,document.getElementById("name").textContent=D,i=await j("personas"),f.enqueue(D),re.style.display="none",C()};
