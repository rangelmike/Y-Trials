import"./modulepreload-polyfill-B5Qt9EMX.js";import{getDatabase as F,update as Y,ref as k,get as Z,child as X}from"https://www.gstatic.com/firebasejs/9.15.0/firebase-database.js";import{initializeApp as K}from"https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";import{getAuth as G,signOut as V}from"https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";var l={FIREBASE_API_KEY:'"AIzaSyBnbcPg2bm9uNHtQvSCKwneB9qyUC4RYPs"',FIREBASE_AUTH_DOMAIN:'"y-trials.firebaseapp.com"',FIREBASE_DATABASE_URL:'"https://y-trials-default-rtdb.firebaseio.com"',FIREBASE_PROJECT_ID:'"y-trials"',FIREBASE_STORAGE_BUCKET:'"y-trials.appspot.com"',FIREBASE_MESSAGING_SENDER_ID:'"38252670103"',FIREBASE_APP_ID:'"1:38252670103:web:e93dd07b17de6537bc4dd2"',FIREBASE_MEASUREMENT_ID:'"G-DHZ2M1NK82"',SPREADSHEET_APP_ID:'"https://script.google.com/macros/s/AKfycbxCcBN7Ono829TeRK8iB3QQmZCsBSrds_h4a0pXClcl8T6SEo-TM4oEAShs5fCRXP1V/exec"'};const W={apiKey:l.FIREBASE_API_KEY.replace(/"/g,""),authDomain:l.FIREBASE_AUTH_DOMAIN.replace(/"/g,""),projectId:l.FIREBASE_PROJECT_ID.replace(/"/g,""),storageBucket:l.FIREBASE_STORAGE_BUCKET.replace(/"/g,""),messagingSenderId:l.FIREBASE_MESSAGING_SENDER_ID.replace(/"/g,""),appId:l.FIREBASE_APP_ID.replace(/"/g,""),measurementId:l.FIREBASE_MEASUREMENT_ID.replace(/"/g,""),databaseURL:l.FIREBASE_DATABASE_URL.replace(/"/g,"")},L=K(W),ee=F(L);G(L);function R(t){let o=0;for(const e of t)o+=e;return o}function te(t){let o="";for(const e of t)o+=`${e}, `;return o.slice(0,-2)}async function oe(t,o){let e=2;const a=l.SPREADSHEET_APP_ID.replace(/"/g,"");for(let s=0;s<Object.values(t).length;s++){const c=Object.entries(t)[s],n=c[0];if(n==o)continue;const I=c[1].wentDates!=null?Object.values(c[1].wentDates).length:0,_=c[1].missedDates!=null?Object.values(c[1].missedDates).length:0,g=c[1].rprts!=null?R(Object.values(c[1].rprts)):0,m=c[1].ejercicio!=null?R(Object.values(c[1].ejercicio)):0,B=c[1].cuotas!=null?R(Object.values(c[1].cuotas)):0,b=c[1].listBooks!=null?te(Object.values(c[1].listBooks)):"";await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},mode:"no-cors",body:JSON.stringify({A:n,B:I,C:_,E:g,G:m,I:B,J:b,Z:e})}).catch(S=>{console.error("Error:",S),alert("Error: "+S.message)}),e++}await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},mode:"no-cors",body:JSON.stringify({desde:e})}).then(s=>{alert("Hoja de Cálculo actualizada correctamente")}).catch(s=>{console.error("Error:",s),alert("Error: "+s.message)})}function se(t){let o={};for(let e=0;e<Object.values(t).length;e++){const a=Object.entries(t)[e];if(a[1].subs!=null&&a[1].subs!=""){const s={subs:a[1].subs,email:a[1].email,NombreCentro:a[1].NombreCentro};o[a[0]]=s}}Y(k(ee,"/"),{personas:o}).then(e=>{alert("Base de Datos actualizada correctamente")}).catch(e=>{console.error("Error:",e),alert("Error: "+e)})}var E={FIREBASE_API_KEY:'"AIzaSyBnbcPg2bm9uNHtQvSCKwneB9qyUC4RYPs"',FIREBASE_AUTH_DOMAIN:'"y-trials.firebaseapp.com"',FIREBASE_DATABASE_URL:'"https://y-trials-default-rtdb.firebaseio.com"',FIREBASE_PROJECT_ID:'"y-trials"',FIREBASE_STORAGE_BUCKET:'"y-trials.appspot.com"',FIREBASE_MESSAGING_SENDER_ID:'"38252670103"',FIREBASE_APP_ID:'"1:38252670103:web:e93dd07b17de6537bc4dd2"',FIREBASE_MEASUREMENT_ID:'"G-DHZ2M1NK82"',SPREADSHEET_APP_ID:'"https://script.google.com/macros/s/AKfycbxCcBN7Ono829TeRK8iB3QQmZCsBSrds_h4a0pXClcl8T6SEo-TM4oEAShs5fCRXP1V/exec"'};const ne={apiKey:E.FIREBASE_API_KEY.replace(/"/g,""),authDomain:E.FIREBASE_AUTH_DOMAIN.replace(/"/g,""),projectId:E.FIREBASE_PROJECT_ID.replace(/"/g,""),storageBucket:E.FIREBASE_STORAGE_BUCKET.replace(/"/g,""),messagingSenderId:E.FIREBASE_MESSAGING_SENDER_ID.replace(/"/g,""),appId:E.FIREBASE_APP_ID.replace(/"/g,""),measurementId:E.FIREBASE_MEASUREMENT_ID.replace(/"/g,""),databaseURL:E.FIREBASE_DATABASE_URL.replace(/"/g,"")},H=K(ne);F(H);const ae=G(H),ce=document.getElementById("datos"),re=document.getElementById("loader"),T=sessionStorage.getItem("myName"),y=document.getElementById("UpStuff");let i;class ie{constructor(){this.items=[]}enqueue(o){this.items.push(o)}dequeue(){if(this.isEmpty())throw new Error("Queue is empty");return this.items.shift()}peek(){if(this.isEmpty())throw new Error("Queue is empty");return this.items[0]}isEmpty(){return this.items.length===0}size(){return this.items.length}print(){console.log(this.items.toString())}}let f=new ie;document.getElementById("logoutBtn").addEventListener("click",()=>{V(ae),window.location.href="index.html"});y.addEventListener("click",async()=>{document.getElementById("UpSheet").checked&&(y.style.display="none",await oe(i,T)),document.getElementById("reset").checked&&(await se(i),location.reload()),y.style.display="block"});function r(t){const o=document.createElement("p");return o.textContent=t,o}function u(t,o){let e=0;if(i[o][t]!=null)for(const a of Object.values(i[o][t]))e+=a;return e}function D(t,o){let e="",a=0;if(i[o][t]!=null)for(const s of Object.values(i[o][t]))e+=s+"; ",a++;return{str:e,num:a}}function le(t){return t=="none"?"block":"none"}function de(t,o){const e=document.createElement("div"),a=document.createElement("h3");a.textContent=t+" ("+i[t].NombreCentro+")",e.append(a),ce.append(e);for(const s of o){if(i[s]==null){const A=document.createElement("p");A.textContent=`No hay registros de infromación aún sobre ${s}`,e.append(A);continue}const c=document.createElement("h4"),n=document.createElement("div");c.textContent=s,n.classList=s,e.append(c),e.append(n);const{str:I,num:_}=D("wentDates",s),g=I,m=_;n.append(r("Fechas que asistio: "+g));const{str:B,num:b}=D("missedDates",s),O=B,S=b;n.append(r("Fechas que falto: "+O));const d=Number(m+S),q=`${Math.floor(100*m/d)}`;n.append(r("Porcentaje de asistencia: "+q+`% (${m}/${d})`));const P=u("rprts",s);n.append(r(`Total de reportes: ${P}`)),n.append(r(`Promedio reportes: ${(P/d).toFixed(2)}`));const j=u("ejercicio",s);n.append(r(`Total dias de ejercicio: ${j}`)),n.append(r(`Promedio dias de ejercicio: ${(j/d).toFixed(2)}`));const J=u("cuotas",s);n.append(r(`Total cuotas pagadas: ${J}`));const C=u("comisiones",s);n.append(r(`Promedio de cumplimiento de comisiones: ${(C*100/d).toFixed(2)}% (${C}/${d})`));let N="",w="";i[s].actBook!=null&&(N=Object.keys(i[s].actBook),w=Object.values(i[s].actBook)),n.append(r(`Actualmente leyendo: ${N} /Desde: ${w}`));const{str:Q,num:Ee}=D("listBooks",s),z=Q;n.append(r(`Lista de libros leidos: ${z}`)),n.style.display="none",c.addEventListener("click",function(){n.style.display=le(n.style.display)});const x=u("misas",s);n.append(r(`Total de misas acudidas: ${x}`)),n.append(r(`Promedio dias de misas por semana: ${(x/d).toFixed(2)}`));const U=u("rosarios",s);n.append(r(`Total de rosarios: ${U}`)),n.append(r(`Promedio de rosarios por semana: ${(U/d).toFixed(2)}`));const $=i[s].observaciones;if($!=null){const A=r("Observaciones:");A.style.marginBottom="0px",n.append(A);const p=document.createElement("textarea");p.value=$,p.style.height="auto",p.setAttribute("readonly","true"),p.onmousedown=function(h){h.preventDefault()},p.onselectstart=function(h){h.preventDefault()},n.append(p)}else n.append(r("Observaciones: ninguna"))}}function v(){if(!f.isEmpty()){const t=f.dequeue();if(i[t]==null){v();return}let o=i[t].subs;if(o!=null){o=Object.values(o);for(const e of o)f.enqueue(e);de(t,o)}v()}}function M(t){const o=k(F());return Z(X(o,t)).then(e=>e.exists()?e.val():(console.log("No data available"),0)).catch(e=>(console.error(e),0))}window.onload=async function(){const t=sessionStorage.getItem("myEmail");if(t==""&&(window.location.href="index.html"),Object.keys(await M("jefe"))[0].replace(/,/g,".")==t){const e=document.querySelectorAll(".NO");for(let a=0;a<e.length;a++)e[a].style.display="block"}document.getElementById("email").textContent=t,document.getElementById("name").textContent=T,i=await M("personas"),f.enqueue(T),re.style.display="none",v()};
