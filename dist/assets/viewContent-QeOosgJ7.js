import"./modulepreload-polyfill-B5Qt9EMX.js";import{getDatabase as v,ref as X,get as J,child as Z}from"https://www.gstatic.com/firebasejs/9.15.0/firebase-database.js";import{initializeApp as $}from"https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";import{getAuth as K,signOut as Y}from"https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";var r={FIREBASE_API_KEY:'"AIzaSyBnbcPg2bm9uNHtQvSCKwneB9qyUC4RYPs"',FIREBASE_AUTH_DOMAIN:'"y-trials.firebaseapp.com"',FIREBASE_DATABASE_URL:'"https://y-trials-default-rtdb.firebaseio.com"',FIREBASE_PROJECT_ID:'"y-trials"',FIREBASE_STORAGE_BUCKET:'"y-trials.appspot.com"',FIREBASE_MESSAGING_SENDER_ID:'"38252670103"',FIREBASE_APP_ID:'"1:38252670103:web:e93dd07b17de6537bc4dd2"',FIREBASE_MEASUREMENT_ID:'"G-DHZ2M1NK82"',SPREADSHEET_APP_ID:'"https://script.google.com/macros/s/AKfycbxCcBN7Ono829TeRK8iB3QQmZCsBSrds_h4a0pXClcl8T6SEo-TM4oEAShs5fCRXP1V/exec"'};const z={apiKey:r.FIREBASE_API_KEY.replace(/"/g,""),authDomain:r.FIREBASE_AUTH_DOMAIN.replace(/"/g,""),projectId:r.FIREBASE_PROJECT_ID.replace(/"/g,""),storageBucket:r.FIREBASE_STORAGE_BUCKET.replace(/"/g,""),messagingSenderId:r.FIREBASE_MESSAGING_SENDER_ID.replace(/"/g,""),appId:r.FIREBASE_APP_ID.replace(/"/g,""),measurementId:r.FIREBASE_MEASUREMENT_ID.replace(/"/g,""),databaseURL:r.FIREBASE_DATABASE_URL.replace(/"/g,"")},U=$(z);v(U);K(U);function y(t){let o=0;for(const s of t)o+=s;return o}function V(t){let o="";for(const s of t)o+=`${s}, `;return o.slice(0,-2)}async function W(t,o){let s=2;for(let a=0;a<Object.values(t).length;a++){const e=Object.entries(t)[a],E=e[0];if(E==o)continue;const n=e[1].wentDates!=null?Object.values(e[1].wentDates).length:0,I=e[1].missedDates!=null?Object.values(e[1].missedDates).length:0,_=e[1].rprts!=null?y(Object.values(e[1].rprts)):0,g=e[1].ejercicio!=null?y(Object.values(e[1].ejercicio)):0,u=e[1].cuotas!=null?y(Object.values(e[1].cuotas)):0,B=e[1].listBooks!=null?V(Object.values(e[1].listBooks)):"",h={A:E,B:n,C:I,E:_,G:g,I:u,J:B,Z:s};console.log(r.SPREADSHEET_APP_ID),await fetch("https://script.google.com/macros/s/AKfycbxCcBN7Ono829TeRK8iB3QQmZCsBSrds_h4a0pXClcl8T6SEo-TM4oEAShs5fCRXP1V/exec",{method:"POST",headers:{"Content-Type":"application/json"},mode:"no-cors",body:JSON.stringify(h)}).catch(S=>{console.error("Error:",S),alert("Error: "+S.message)}),s++}await fetch("https://script.google.com/macros/s/AKfycbxCcBN7Ono829TeRK8iB3QQmZCsBSrds_h4a0pXClcl8T6SEo-TM4oEAShs5fCRXP1V/exec",{method:"POST",headers:{"Content-Type":"application/json"},mode:"no-cors",body:JSON.stringify({desde:s})}).catch(a=>{console.error("Error:",a),alert("Error: "+a.message)})}var d={FIREBASE_API_KEY:'"AIzaSyBnbcPg2bm9uNHtQvSCKwneB9qyUC4RYPs"',FIREBASE_AUTH_DOMAIN:'"y-trials.firebaseapp.com"',FIREBASE_DATABASE_URL:'"https://y-trials-default-rtdb.firebaseio.com"',FIREBASE_PROJECT_ID:'"y-trials"',FIREBASE_STORAGE_BUCKET:'"y-trials.appspot.com"',FIREBASE_MESSAGING_SENDER_ID:'"38252670103"',FIREBASE_APP_ID:'"1:38252670103:web:e93dd07b17de6537bc4dd2"',FIREBASE_MEASUREMENT_ID:'"G-DHZ2M1NK82"',SPREADSHEET_APP_ID:'"https://script.google.com/macros/s/AKfycbxCcBN7Ono829TeRK8iB3QQmZCsBSrds_h4a0pXClcl8T6SEo-TM4oEAShs5fCRXP1V/exec"'};const ee={apiKey:d.FIREBASE_API_KEY.replace(/"/g,""),authDomain:d.FIREBASE_AUTH_DOMAIN.replace(/"/g,""),projectId:d.FIREBASE_PROJECT_ID.replace(/"/g,""),storageBucket:d.FIREBASE_STORAGE_BUCKET.replace(/"/g,""),messagingSenderId:d.FIREBASE_MESSAGING_SENDER_ID.replace(/"/g,""),appId:d.FIREBASE_APP_ID.replace(/"/g,""),measurementId:d.FIREBASE_MEASUREMENT_ID.replace(/"/g,""),databaseURL:d.FIREBASE_DATABASE_URL.replace(/"/g,"")},k=$(ee);v(k);const te=K(k),oe=document.getElementById("datos"),se=document.getElementById("loader"),D=sessionStorage.getItem("myName");let i;class ne{constructor(){this.items=[]}enqueue(o){this.items.push(o)}dequeue(){if(this.isEmpty())throw new Error("Queue is empty");return this.items.shift()}peek(){if(this.isEmpty())throw new Error("Queue is empty");return this.items[0]}isEmpty(){return this.items.length===0}size(){return this.items.length}print(){console.log(this.items.toString())}}let f=new ne;document.getElementById("logoutBtn").addEventListener("click",()=>{Y(te),window.location.href="index.html"});document.getElementById("UpStuff").addEventListener("click",()=>{document.getElementById("reset").checked&&console.log("reset"),document.getElementById("UpSheet").checked&&W(i,D)});function c(t){const o=document.createElement("p");return o.textContent=t,o}function m(t,o){let s=0;if(i[o][t]!=null)for(const a of Object.values(i[o][t]))s+=a;return s}function b(t,o){let s="",a=0;if(i[o][t]!=null)for(const e of Object.values(i[o][t]))s+=e+"; ",a++;return{str:s,num:a}}function ae(t){return t=="none"?"block":"none"}function ce(t,o){const s=document.createElement("div"),a=document.createElement("h3");a.textContent=t+" ("+i[t].NombreCentro+")",s.append(a),oe.append(s);for(const e of o){if(i[e]==null){const A=document.createElement("p");A.textContent=`No hay registros de infromación aún sobre ${e}`,s.append(A);continue}const E=document.createElement("h4"),n=document.createElement("div");E.textContent=e,n.classList=e,s.append(E),s.append(n);const{str:I,num:_}=b("wentDates",e),g=I,u=_;n.append(c("Fechas que asistio: "+g));const{str:B,num:h}=b("missedDates",e),S=B,G=h;n.append(c("Fechas que falto: "+S));const l=Number(u+G),L=`${Math.floor(100*u/l)}`;n.append(c("Porcentaje de asistencia: "+L+`% (${u}/${l})`));const C=m("rprts",e);n.append(c(`Total de reportes: ${C}`)),n.append(c(`Promedio reportes: ${(C/l).toFixed(2)}`));const F=m("ejercicio",e);n.append(c(`Total dias de ejercicio: ${F}`)),n.append(c(`Promedio dias de ejercicio: ${(F/l).toFixed(2)}`));const H=m("cuotas",e);n.append(c(`Total cuotas pagadas: ${H}`));const P=m("comisiones",e);n.append(c(`Promedio de cumplimiento de comisiones: ${(P*100/l).toFixed(2)}% (${P}/${l})`));let O="",N="";i[e].actBook!=null&&(O=Object.keys(i[e].actBook),N=Object.values(i[e].actBook)),n.append(c(`Actualmente leyendo: ${O} /Desde: ${N}`));const{str:Q,num:ie}=b("listBooks",e),q=Q;n.append(c(`Lista de libros leidos: ${q}`)),n.style.display="none",E.addEventListener("click",function(){n.style.display=ae(n.style.display)});const j=m("misas",e);n.append(c(`Total de misas acudidas: ${j}`)),n.append(c(`Promedio dias de misas por semana: ${(j/l).toFixed(2)}`));const x=m("rosarios",e);n.append(c(`Total de rosarios: ${x}`)),n.append(c(`Promedio de rosarios por semana: ${(x/l).toFixed(2)}`));const w=i[e].observaciones;if(w!=null){const A=c("Observaciones:");A.style.marginBottom="0px",n.append(A);const p=document.createElement("textarea");p.value=w,p.style.height="auto",p.setAttribute("readonly","true"),p.onmousedown=function(R){R.preventDefault()},p.onselectstart=function(R){R.preventDefault()},n.append(p)}else n.append(c("Observaciones: ninguna"))}}function T(){if(!f.isEmpty()){const t=f.dequeue();if(i[t]==null){T();return}let o=i[t].subs;if(o!=null){o=Object.values(o);for(const s of o)f.enqueue(s);ce(t,o)}T()}}function M(t){const o=X(v());return J(Z(o,t)).then(s=>s.exists()?s.val():(console.log("No data available"),0)).catch(s=>(console.error(s),0))}window.onload=async function(){const t=sessionStorage.getItem("myEmail");if(t==""&&(window.location.href="index.html"),Object.keys(await M("jefe"))[0].replace(/,/g,".")==t){const s=document.querySelectorAll(".NO");for(let a=0;a<s.length;a++)s[a].style.display="block"}document.getElementById("email").textContent=t,document.getElementById("name").textContent=D,i=await M("personas"),f.enqueue(D),se.style.display="none",T()};
